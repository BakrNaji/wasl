{% load static %}

<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <title>WoOx Travel Reservation Page</title>

    <!-- Bootstrap core CSS -->
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="{% static 'assets/css/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/templatemo-woox-travel.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/owl.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/animate.css' %}">
    <link rel="stylesheet"href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
<!--

TemplateMo 580 Woox Travel

https://templatemo.com/tm-580-woox-travel

-->
  </head>

<body>



{% include 'parts/preloader.html' %}
{% include 'parts/nav.html' %}

<div class="reservation-form">
    <div class="container">
      <div class="row" style="direction: rtl;">
        <div class="col-lg-12">
          <center>
          <div class="col-lg-12" style="background-color: #22b3c1; border-top-left-radius:30px; border-top-right-radius:30px; position:relative; padding:18px;">
            {% if photo_url %}
              <img src="{{ photo_url }}" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©" style="width:96px;height:96px;border-radius:50%;object-fit:cover;border:3px solid #fff;position:absolute; right:16px; top:8px;"/>
            {% endif %}
            <h4 style="margin:0;">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h4>
            {% if request.user.is_authenticated %}
              <button id="edit-profile-toggle" type="button" class="btn btn-light" style="position:absolute; left:16px; top:8px;">ØªØ¹Ø¯ÙŠÙ„</button>
            {% endif %}
          </div>
        </center>
          {% if request.user.is_authenticated %}
          <div id="edit-profile-section" style="display:none;">
          <form id="reservation-form" method="POST">
          {% csrf_token %}
            {% include 'parts/_alerts.html' %}
            <div class="row">
              

              <div class="col-lg-6">
                  <fieldset>
                      <label for="Name" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø§ÙˆÙ„</label>
                      <input type="text" name="fname" class="Name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø§ÙˆÙ„" value="{{fname}}" required>
                  </fieldset>
              </div>
              <div class="col-lg-6">
                <fieldset>
                    <label for="Name" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø§Ø®ÙŠØ±</label>
                    <input type="text" name="lname" class="Name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø§Ø®ÙŠØ±" value="{{lname}}" required>
                </fieldset>
                </div>
                
    
                  <div class="col-lg-6">
                    <fieldset>
                        <label for="Name" class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                        <input type="text" name="address" required value="{{address}}">
                    </fieldset>
                    </div>
                <div class="col-lg-6">
                    <fieldset>
                        <label for="Name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" name="user" class="Name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" value="{{user}}" required readonly>
                    </fieldset>
                    </div>
                    <div class="col-lg-6">
                        <fieldset>
                            <label for="Name" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" name="email" placeholder="name@example.com" required value="{{email}}" readonly>
                        </fieldset>
                        </div>
                      <div class="col-lg-6">
                        <fieldset>
                          <label for="branch" class="form-label">Ø§Ù„ÙØ±Ø¹</label>
                          <input type="text" name="branch" value="{{ branch }}">
                        </fieldset>
                      </div>
                      <div class="col-lg-6">
                        <fieldset>
                          <label for="department" class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                          <input type="text" name="department" value="{{ department }}">
                        </fieldset>
                      </div>
                      <div class="col-lg-6">
                        <fieldset>
                          <label for="job_title" class="form-label">Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
                          <input type="text" name="job_title" value="{{ job_title }}">
                        </fieldset>
                      </div>
              <!-- <div class="col-lg-6">
                <fieldset>
                    <label for="Number" class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="text" name="Number" class="Number" placeholder="7xxxxxxxx" autocomplete="on" required>
                </fieldset>
              </div> -->
              <div class="border-button"><a href="{% url 'change_password' %}">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</a></div>
              <div class="col-lg-12">                        
                  <fieldset>
                      <button type="submit" name="btnsave" class="main-button">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                  </fieldset>
              </div>
            </div>
          </form>
          </div>
          
          <!-- ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
          {% if employee_evaluations %}
          <div class="col-lg-12" style="margin-top:30px;">
            <div class="card" style="border-radius:12px; padding:25px; box-shadow:0 4px 12px rgba(0,0,0,0.1); border-top:4px solid #F2A23F;">
              <h4 style="color:#F2A23F; font-weight:700; margin-bottom:20px; display:flex; align-items:center; gap:10px;">â­ ØªÙ‚ÙŠÙŠÙ…Ø§ØªÙŠ</h4>
              
              {% if latest_employee_eval %}
              <div style="background:linear-gradient(135deg, #F2A23F 0%, #f5b35a 100%); color:white; padding:20px; border-radius:10px; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                  <div>
                    <h5 style="margin:0; font-weight:700;">ğŸ“Š Ø¢Ø®Ø± ØªÙ‚ÙŠÙŠÙ…</h5>
                    <small style="opacity:0.9;">{{ latest_employee_eval.month|date:'Y-m' }}</small>
                  </div>
                  <div style="background:rgba(255,255,255,0.2); padding:15px 25px; border-radius:8px; text-align:center;">
                    <div style="font-size:28px; font-weight:700;">{{ latest_employee_eval.percentage|floatformat:1 }}%</div>
                    <small style="opacity:0.9;">{{ latest_employee_eval.total_score }} Ù…Ù† {{ latest_employee_eval.max_possible_score }}</small>
                  </div>
                </div>
                <div style="margin-top:15px; padding-top:15px; border-top:1px solid rgba(255,255,255,0.2);">
                  <p style="margin:5px 0;"><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> {{ latest_employee_eval.total_observations }}</p>
                  {% if latest_employee_eval.notes %}
                  <p style="margin:5px 0;"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> {{ latest_employee_eval.notes }}</p>
                  {% endif %}
                </div>
              </div>
              {% endif %}
              
              <div style="display:grid; gap:15px;">
                {% for ev in employee_evaluations %}
                <div class="card" style="border-radius:10px; border-right:4px solid #F2A23F; padding:15px; background:#f8f9fa;">
                  <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:10px;">
                    <div>
                      <h6 style="color:#235E88; margin:0; font-weight:700;">{{ ev.month|date:'F Y' }}</h6>
                      <small style="color:#666;">Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…: {{ ev.evaluator.user.username }}</small>
                    </div>
                    <div style="background:#F2A23F; color:#fff; padding:8px 15px; border-radius:6px; font-weight:700;">{{ ev.percentage|floatformat:1 }}%</div>
                  </div>
                  <div style="display:flex; gap:20px; margin-top:10px; padding:10px; background:white; border-radius:6px;">
                    <div style="text-align:center;">
                      <div style="font-size:20px; font-weight:700; color:#235E88;">{{ ev.total_observations }}</div>
                      <small style="color:#666;">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</small>
                    </div>
                    <div style="text-align:center;">
                      <div style="font-size:20px; font-weight:700; color:#28a745;">{{ ev.total_score }}</div>
                      <small style="color:#666;">Ø§Ù„Ù†Ù‚Ø§Ø·</small>
                    </div>
                  </div>
                  {% if ev.notes %}
                  <div style="margin-top:10px; padding:10px; background:white; border-radius:6px; border-right:3px solid #235E88;">
                    <small style="color:#999;">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©:</small>
                    <p style="margin:5px 0 0 0; color:#555;">{{ ev.notes }}</p>
                  </div>
                  {% endif %}
                </div>
                {% empty %}
                <p style="color:#999; text-align:center;">Ù„Ù… ÙŠØªÙ… ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø¨Ø¹Ø¯.</p>
                {% endfor %}
              </div>
            </div>
          </div>
          {% endif %}
          
           <!-- Owner Evaluations Section - NEW SYSTEM -->
           {% if is_owner %}
           <div class="col-lg-12" style="margin-top:30px;">
             <div class="card" style="border-radius:12px; padding:25px; box-shadow:0 4px 12px rgba(0,0,0,0.1); border-top:4px solid #235E88;">
               <h4 style="color:#235E88; font-weight:700; margin-bottom:20px; display:flex; align-items:center; gap:10px;">ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„ØªÙŠ Ø£Ø¶ÙØªÙ‡Ø§</h4>
             
               <!-- Department Evaluations -->
               {% if owner_dept_evaluations %}
               <h5 style="color:#235E88; font-weight:600; margin-top:20px; margin-bottom:15px;">ğŸ¢ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h5>
               <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:15px; margin-bottom:30px;">
                 {% for ev in owner_dept_evaluations %}
                 <div class="card" style="border-radius:10px; border-left:4px solid #235E88; padding:15px; background:#f8f9fa; transition:all 0.2s;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)';">
                   <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:12px;">
                     <div>
                       <h5 style="color:#235E88; margin:0; font-weight:700;">ğŸ¢ {{ ev.department.name }}</h5>
                       <small style="color:#666;">{{ ev.month|date:'Y-m' }}</small>
                     </div>
                     <div style="background:#235E88; color:#fff; padding:8px 12px; border-radius:6px; font-weight:700; font-size:18px;">{{ ev.percentage|floatformat:1 }}%</div>
                   </div>
                   
                   <p style="margin:8px 0; color:#666; font-size:14px;"><strong>ğŸ“ Ø§Ù„ÙØ±Ø¹:</strong> {{ ev.department.branch.name|default:'---' }}</p>
                   <div style="display:flex; gap:15px; margin-top:10px; padding:10px; background:white; border-radius:6px;">
                     <div style="text-align:center;">
                       <div style="font-size:18px; font-weight:700; color:#dc3545;">{{ ev.total_observations }}</div>
                       <small style="color:#666;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</small>
                     </div>
                     <div style="text-align:center;">
                       <div style="font-size:18px; font-weight:700; color:#28a745;">{{ ev.total_score }}</div>
                       <small style="color:#666;">Ù†Ù‚Ø§Ø·</small>
                     </div>
                   </div>
                   
                   {% if ev.notes %}
                   <div style="background:#fff; padding:10px; border-radius:6px; margin-top:10px; border-right:3px solid #235E88;">
                     <small style="color:#999; display:block; margin-bottom:5px;">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</small>
                     <p style="margin:0; color:#555; font-size:14px;">{{ ev.notes }}</p>
                   </div>
                   {% endif %}
                 </div>
                 {% endfor %}
               </div>
               {% endif %}

               <!-- Employee Evaluations -->
               {% if owner_emp_evaluations %}
               <h5 style="color:#F2A23F; font-weight:600; margin-top:20px; margin-bottom:15px;">ğŸ‘¤ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h5>
               <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:15px;">
                 {% for ev in owner_emp_evaluations %}
                 <div class="card" style="border-radius:10px; border-left:4px solid #F2A23F; padding:15px; background:#f8f9fa; transition:all 0.2s;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)';">
                   <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:12px;">
                     <div>
                       <h5 style="color:#F2A23F; margin:0; font-weight:700;">ğŸ‘¤ {{ ev.employee.user.username }}</h5>
                       <small style="color:#666;">{{ ev.month|date:'Y-m' }}</small>
                     </div>
                     <div style="background:#F2A23F; color:#fff; padding:8px 12px; border-radius:6px; font-weight:700; font-size:18px;">{{ ev.percentage|floatformat:1 }}%</div>
                   </div>
                   
                   <p style="margin:8px 0; color:#666; font-size:14px;"><strong>ğŸ“ Ø§Ù„ÙØ±Ø¹:</strong> {{ ev.employee.branch.name|default:'---' }}</p>
                   <p style="margin:8px 0; color:#666; font-size:14px;"><strong>ğŸ¢ Ø§Ù„Ù‚Ø³Ù…:</strong> {{ ev.employee.department.name|default:'---' }}</p>
                   
                   <div style="display:flex; gap:15px; margin-top:10px; padding:10px; background:white; border-radius:6px;">
                     <div style="text-align:center;">
                       <div style="font-size:18px; font-weight:700; color:#dc3545;">{{ ev.total_observations }}</div>
                       <small style="color:#666;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</small>
                     </div>
                     <div style="text-align:center;">
                       <div style="font-size:18px; font-weight:700; color:#28a745;">{{ ev.total_score }}</div>
                       <small style="color:#666;">Ù†Ù‚Ø§Ø·</small>
                     </div>
                   </div>
                   
                   {% if ev.notes %}
                   <div style="background:#fff; padding:10px; border-radius:6px; margin-top:10px; border-right:3px solid #F2A23F;">
                     <small style="color:#999; display:block; margin-bottom:5px;">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</small>
                     <p style="margin:0; color:#555; font-size:14px;">{{ ev.notes }}</p>
                   </div>
                   {% endif %}
                 </div>
                 {% endfor %}
               </div>
               {% endif %}

               {% if not owner_dept_evaluations and not owner_emp_evaluations %}
               <p style="color:#999; text-align:center;">Ù„Ù… ØªØ¶Ù Ø£ÙŠ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯.</p>
               {% endif %}
             </div>
           </div>
           {% endif %}
          {% else %}
          <h4 class="alert alert-danger">
              ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ 
              <a href="{% url 'login' %}">
                  ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
              </a>
          </h4>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

{% include 'parts/footer.html' %}


  <!-- Scripts -->
  <!-- Bootstrap core JavaScript -->
  <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>

  <script src="{% static 'assets/js/isotope.min.js' %}"></script>
  <script src="{% static 'assets/js/owl-carousel.js' %}"></script>
  <script src="{% static 'assets/js/wow.js' %}"></script>
  <script src="{% static 'assets/js/tabs.js' %}"></script>
  <script src="{% static 'assets/js/popup.js' %}"></script>
  <script src="{% static 'assets/js/custom.js' %}"></script>

  <script>
    $(".option").click(function(){
      $(".option").removeClass("active");
      $(this).addClass("active"); 
    });
  </script>

  <script>
    (function($){
      $(document).ready(function(){
        var $toggle = $('#edit-profile-toggle');
        var $section = $('#edit-profile-section');
        if($toggle.length && $section.length){
          $toggle.on('click', function(){
            $section.slideToggle(200);
            // change button text
            var txt = $toggle.text().trim();
            $toggle.text(txt === 'ØªØ¹Ø¯ÙŠÙ„' ? 'Ø¥Ù„ØºØ§Ø¡' : 'ØªØ¹Ø¯ÙŠÙ„');
          });
        }
      });
    })(jQuery);
  </script>

  </body>

</html>
